# DPlayer弹幕播放器 VIP视频解析功能使用说明

## 🎯 功能概述

DPlayer弹幕播放器现已集成VIP视频解析功能，支持自动解析主流VIP视频网站的付费内容，包括爱奇艺、腾讯视频、优酷、芒果TV等平台的VIP视频。

## ✨ 主要特性

### 🔄 多接口轮换机制
- 支持配置多个解析接口URL
- 主接口失败时自动切换到备用接口
- 智能故障转移，提高解析成功率

### ⚡ 智能缓存系统
- 解析结果自动缓存，避免重复解析
- 可配置缓存时间（默认1小时）
- 支持手动清理缓存

### 🛡️ 安全防护机制
- 输入URL验证和过滤
- 解析频率限制
- 支持的VIP网站域名白名单

### 📊 完整的管理界面
- Web后台配置管理
- 解析统计和监控
- 接口测试和健康检查
- 日志记录和调试

## 🚀 快速开始

### 1. 启用解析功能

1. 登录DPlayer管理后台
2. 进入"弹幕播放器设置"页面
3. 切换到"VIP解析设置"选项卡
4. 开启"启用解析功能"开关

### 2. 配置解析接口

默认已配置以下解析接口：
```
https://jiexi.789jiexi.net:4433/?url=
https://jx.jsonplayer.com/player/?url=
https://jx.parwix.com:4433/player/?url=
https://jx.blbo.cc:4433/?url=
```

您可以：
- 添加新的解析接口
- 删除不稳定的接口
- 测试接口可用性
- 调整接口优先级

### 3. 设置解析参数

- **解析超时时间**：建议设置为30秒
- **重试次数**：建议设置为3次
- **缓存时间**：建议设置为3600秒（1小时）
- **日志级别**：建议设置为"信息"

## 📋 使用方法

### 自动解析（推荐）

当播放器检测到VIP视频链接时，会自动触发解析：

1. 用户访问包含VIP视频链接的页面
2. 播放器自动检测VIP域名
3. 显示解析进度对话框
4. 解析成功后自动播放视频

### 手动测试解析

在管理后台可以手动测试解析功能：

1. 进入"VIP解析设置"页面
2. 点击"测试解析"按钮
3. 输入VIP视频链接
4. 查看解析结果

## 🔧 配置文件说明

解析功能的配置保存在 `static/player/cj/dplayer/save/config.inc.php` 文件中：

```php
'解析接口' => [
    'enable' => true,                    // 是否启用解析功能
    'timeout' => 30,                     // 解析超时时间（秒）
    'retry_count' => 3,                  // 单个接口重试次数
    'cache_time' => 3600,                // 解析结果缓存时间（秒）
    'log_level' => 'info',               // 日志级别
    'apis' => [                          // 解析接口列表
        'https://jiexi.789jiexi.net:4433/?url=',
        // 更多接口...
    ],
    'vip_domains' => [                   // 支持的VIP网站域名
        'v.qq.com',                      // 腾讯视频
        'www.iqiyi.com',                 // 爱奇艺
        // 更多域名...
    ]
]
```

## 🎬 支持的VIP网站

目前支持以下VIP视频网站：

| 网站名称 | 域名 | 支持状态 |
|---------|------|---------|
| 腾讯视频 | v.qq.com | ✅ 支持 |
| 爱奇艺 | www.iqiyi.com | ✅ 支持 |
| 优酷 | v.youku.com | ✅ 支持 |
| 芒果TV | www.mgtv.com | ✅ 支持 |
| 搜狐视频 | tv.sohu.com | ✅ 支持 |
| 乐视 | www.le.com | ✅ 支持 |
| 哔哩哔哩 | www.bilibili.com | ✅ 支持 |

## 📊 API接口说明

### 解析视频接口
```
GET /static/player/cj/dplayer/?ac=parse&url={VIP视频链接}
```

**响应格式：**
```json
{
    "success": true,
    "code": 1,
    "message": "解析成功",
    "data": {
        "url": "解析后的直链URL",
        "type": "视频类型",
        "title": "视频标题",
        "original_url": "原始VIP链接"
    }
}
```

### 获取解析统计
```
GET /static/player/cj/dplayer/?ac=parse_stats
```

### 清理解析缓存
```
GET /static/player/cj/dplayer/?ac=clear_parse_cache
```

## 🔍 故障排除

### 常见问题

**1. 解析失败**
- 检查解析接口是否可用
- 确认VIP链接格式正确
- 查看解析日志获取详细错误信息

**2. 解析速度慢**
- 调整解析超时时间
- 更换更快的解析接口
- 检查网络连接状况

**3. 缓存问题**
- 手动清理解析缓存
- 调整缓存时间设置
- 检查缓存目录权限

### 日志查看

解析日志保存在：`static/player/cj/dplayer/save/parse.log`

日志格式：
```
[2024-01-01 12:00:00] [info] 开始解析: https://v.qq.com/x/cover/xxx
[2024-01-01 12:00:05] [info] 解析成功 API1: https://v.qq.com/x/cover/xxx -> https://xxx.mp4
```

## ⚠️ 注意事项

### 法律声明
- 请确保解析接口的合法性
- 仅用于学习和研究目的
- 遵守相关法律法规和网站服务条款

### 技术要求
- PHP 7.0+ 版本
- 启用 `file_get_contents` 函数
- 确保网络连接正常
- 服务器支持HTTPS请求

### 性能建议
- 定期清理解析缓存
- 监控解析接口状态
- 合理设置超时和重试参数
- 避免频繁解析相同视频

## 🔄 更新日志

### v1.0.0 (2024-01-01)
- ✅ 初始版本发布
- ✅ 支持多接口轮换解析
- ✅ 集成智能缓存系统
- ✅ 完整的Web管理界面
- ✅ 支持主流VIP视频网站

## 📞 技术支持

如果您在使用过程中遇到问题，请：

1. 查看本使用说明
2. 检查解析日志
3. 测试解析接口可用性
4. 确认配置参数正确性

## 🎉 总结

DPlayer VIP视频解析功能为您提供了完整的VIP视频解析解决方案，通过智能的多接口轮换机制和缓存系统，确保高成功率和快速响应。配合直观的Web管理界面，让VIP视频解析变得简单高效。
